<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeSync World - Precision Time Across the Globe</title>
    <meta name="description" content="Accurate world clock with NTP-like synchronization, timezone converter, meeting planner, and more">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Design System */
        :root {
            --color-primary: hsl(240, 100%, 65%);
            --gradient-primary: linear-gradient(135deg, hsl(240, 100%, 65%) 0%, hsl(280, 100%, 65%) 100%);
            --gradient-sunset: linear-gradient(135deg, hsl(38, 92%, 50%) 0%, hsl(0, 84%, 60%) 100%);
            --gradient-ocean: linear-gradient(135deg, hsl(200, 100%, 50%) 0%, hsl(240, 100%, 65%) 100%);
            --gradient-forest: linear-gradient(135deg, hsl(142, 76%, 36%) 0%, hsl(142, 76%, 56%) 100%);
            
            --bg-primary: hsl(0, 0%, 100%);
            --bg-secondary: hsl(240, 20%, 98%);
            --bg-tertiary: hsl(240, 15%, 95%);
            --bg-glass: hsla(0, 0%, 100%, 0.7);
            
            --text-primary: hsl(240, 10%, 10%);
            --text-secondary: hsl(240, 5%, 35%);
            --text-tertiary: hsl(240, 5%, 55%);
            
            --border-color: hsl(240, 10%, 90%);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            
            --color-success: hsl(142, 76%, 56%);
            --color-warning: hsl(38, 92%, 50%);
            --color-error: hsl(0, 84%, 60%);
            
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-full: 9999px;
            
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            --spacing-3xl: 4rem;
        }

        [data-theme="dark"] {
            --bg-primary: hsl(240, 10%, 8%);
            --bg-secondary: hsl(240, 10%, 12%);
            --bg-tertiary: hsl(240, 10%, 16%);
            --bg-glass: hsla(240, 10%, 12%, 0.7);
            --text-primary: hsl(0, 0%, 98%);
            --text-secondary: hsl(240, 5%, 75%);
            --text-tertiary: hsl(240, 5%, 55%);
            --border-color: hsl(240, 10%, 20%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background 0.3s, color 0.3s;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--spacing-lg);
        }

        /* Header */
        header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            padding: var(--spacing-md) 0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .theme-toggle {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-full);
            border: none;
            background: var(--bg-secondary);
            cursor: pointer;
            font-size: 1.5rem;
            transition: transform 0.2s;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        /* Cards */
        .card {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-md);
            transition: all 0.25s;
        }

        .card-glass {
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-md);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: 1rem;
            font-weight: 600;
            border-radius: var(--radius-md);
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        /* Sections */
        section {
            padding: var(--spacing-2xl) 0;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-lg);
        }

        /* Main Clock */
        .main-clock {
            text-align: center;
            padding: var(--spacing-3xl) 0;
        }

        .location-info {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: var(--spacing-md);
        }

        .time-display {
            font-size: 6rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            margin-bottom: var(--spacing-md);
        }

        .milliseconds {
            font-size: 3rem;
            font-weight: 300;
            color: var(--text-secondary);
        }

        /* World Clock Grid */
        .world-clock-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--spacing-lg);
            margin-top: var(--spacing-xl);
        }

        .clock-card {
            position: relative;
            padding: var(--spacing-lg);
        }

        .clock-card.daytime {
            background: linear-gradient(135deg, hsla(200, 100%, 85%, 0.3) 0%, hsla(240, 100%, 85%, 0.3) 100%);
        }

        .clock-card.nighttime {
            background: linear-gradient(135deg, hsla(240, 30%, 20%, 0.5) 0%, hsla(280, 30%, 20%, 0.5) 100%);
        }

        /* Canvas */
        canvas {
            width: 100%;
            height: auto;
            border-radius: var(--radius-lg);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-xl);
            flex-wrap: wrap;
        }

        .tab {
            padding: var(--spacing-sm) var(--spacing-lg);
            border: none;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab.active {
            background: var(--gradient-primary);
            color: white;
        }

        /* Input */
        input, select {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            font-family: 'Inter', sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 1rem;
        }

        /* Utility Classes */
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .gap-sm { gap: var(--spacing-sm); }
        .gap-md { gap: var(--spacing-md); }
        .gap-lg { gap: var(--spacing-lg); }
        .text-center { text-align: center; }
        .mt-md { margin-top: var(--spacing-md); }
        .mt-lg { margin-top: var(--spacing-lg); }
        .mt-xl { margin-top: var(--spacing-xl); }
        .mb-md { margin-bottom: var(--spacing-md); }
        .mb-lg { margin-bottom: var(--spacing-lg); }
        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .text-4xl { font-size: 2.25rem; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .text-secondary { color: var(--text-secondary); }
        .hidden { display: none; }

        /* Divider */
        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border-color), transparent);
            margin: var(--spacing-2xl) 0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .time-display { font-size: 4rem; }
            .milliseconds { font-size: 2rem; }
            .section-title { font-size: 1.5rem; }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-in {
            animation: fadeIn 0.5s ease-out;
        }

        /* Voice Button */
        .voice-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: transform 0.2s;
            z-index: 1000;
        }

        .voice-btn:hover {
            transform: scale(1.1);
        }

        .voice-btn.listening {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div>
                    <div class="logo">üåç TimeSync World</div>
                    <p class="text-sm text-secondary">Precision Time Across the Globe</p>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">üåô</button>
            </div>
        </div>
    </header>

    <!-- Main Clock -->
    <section class="main-clock">
        <div class="container">
            <div id="locationInfo" class="location-info">Detecting location...</div>
            <div class="card-glass" style="display: inline-block; padding: var(--spacing-2xl); min-width: 600px;">
                <div class="time-display">
                    <span id="hours">00</span>:<span id="minutes">00</span>:<span id="seconds">00</span><span class="milliseconds">.<span id="milliseconds">000</span></span>
                </div>
                <div id="dateDisplay" class="text-xl text-secondary"></div>
            </div>
            
            <div class="card mt-xl" style="max-width: 600px; margin-left: auto; margin-right: auto;">
                <div class="flex justify-between items-center mb-md">
                    <h3 class="font-semibold">Time Synchronization</h3>
                    <button class="btn btn-secondary" onclick="resyncTime()">‚ü≥ Resync</button>
                </div>
                <div class="flex justify-between mb-md">
                    <span class="text-secondary">Accuracy:</span>
                    <span id="accuracy" class="font-semibold">¬±0 ms</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-secondary">Status:</span>
                    <span class="font-semibold" style="color: var(--color-success);">Connected</span>
                </div>
            </div>
        </div>
    </section>

    <div class="divider"></div>

    <!-- Day/Night Map -->
    <section>
        <div class="container">
            <h2 class="section-title">Day & Night World Map</h2>
            <div class="card-glass" style="padding: 0; overflow: hidden;">
                <canvas id="dayNightMap" width="1200" height="600"></canvas>
            </div>
            <div class="card mt-lg">
                <p class="text-sm text-secondary">
                    This map shows real-time day and night across the world. The sun marker indicates the current solar position.
                </p>
            </div>
        </div>
    </section>

    <div class="divider"></div>

    <!-- World Clock -->
    <section>
        <div class="container">
            <h2 class="section-title">World Clock</h2>
            <input type="text" id="citySearch" placeholder="Search cities..." oninput="filterCities()" class="mb-lg">
            <div id="worldClockGrid" class="world-clock-grid"></div>
        </div>
    </section>

    <div class="divider"></div>

    <!-- Timezone Converter -->
    <section>
        <div class="container">
            <div class="flex justify-between items-center mb-lg">
                <h2 class="section-title" style="margin: 0;">Timezone Converter</h2>
                <button class="btn btn-primary" onclick="addTimezoneSlot()">+ Add Timezone</button>
            </div>
            <div id="timezoneSlots" class="flex flex-col gap-md"></div>
        </div>
    </section>

    <div class="divider"></div>

    <!-- Time Capsule -->
    <section>
        <div class="container">
            <h2 class="section-title">Time Capsule - Historical Events</h2>
            <div class="card" style="background: var(--gradient-ocean); color: white;">
                <h3 class="text-xl font-bold mb-md">On This Day in History</h3>
                <div id="historicalEvents">Loading historical events...</div>
            </div>
        </div>
    </section>

    <div class="divider"></div>

    <!-- Productivity Timer -->
    <section>
        <div class="container">
            <h2 class="section-title">Productivity Timers</h2>
            <div class="tabs">
                <button class="tab active" onclick="switchTimer('pomodoro')">üçÖ Pomodoro</button>
                <button class="tab" onclick="switchTimer('stopwatch')">‚è±Ô∏è Stopwatch</button>
                <button class="tab" onclick="switchTimer('countdown')">‚è≤Ô∏è Countdown</button>
            </div>
            
            <div id="pomodoroTimer" class="card-glass text-center">
                <div style="font-size: 5rem; font-weight: 700; margin: var(--spacing-xl) 0;">
                    <span id="pomodoroDisplay">25:00</span>
                </div>
                <div class="flex justify-center gap-md">
                    <button class="btn btn-primary" onclick="togglePomodoro()">Start</button>
                    <button class="btn btn-secondary" onclick="resetPomodoro()">Reset</button>
                </div>
                <div class="mt-lg">
                    <div class="text-sm text-secondary">Completed Pomodoros</div>
                    <div class="text-3xl font-bold" style="background: var(--gradient-primary); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
                        <span id="pomodoroCount">0</span>
                    </div>
                </div>
            </div>

            <div id="stopwatchTimer" class="card-glass text-center hidden">
                <div style="font-size: 5rem; font-weight: 700; margin: var(--spacing-xl) 0;">
                    <span id="stopwatchDisplay">00:00:00</span>
                </div>
                <div class="flex justify-center gap-md">
                    <button class="btn btn-primary" onclick="toggleStopwatch()">Start</button>
                    <button class="btn btn-secondary" onclick="resetStopwatch()">Reset</button>
                </div>
            </div>

            <div id="countdownTimer" class="card-glass text-center hidden">
                <div style="font-size: 5rem; font-weight: 700; margin: var(--spacing-xl) 0;">
                    <span id="countdownDisplay">10:00</span>
                </div>
                <div class="flex justify-center gap-sm mb-lg" style="flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="setCountdown(1)">1 min</button>
                    <button class="btn btn-secondary" onclick="setCountdown(5)">5 min</button>
                    <button class="btn btn-secondary" onclick="setCountdown(10)">10 min</button>
                    <button class="btn btn-secondary" onclick="setCountdown(25)">25 min</button>
                </div>
                <div class="flex justify-center gap-md">
                    <button class="btn btn-primary" onclick="toggleCountdown()">Start</button>
                    <button class="btn btn-secondary" onclick="resetCountdown()">Reset</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Voice Button -->
    <button class="voice-btn" onclick="startVoiceCommand()" id="voiceBtn" title="Voice Commands">üé§</button>

    <!-- Footer -->
    <footer style="margin-top: var(--spacing-3xl); padding: var(--spacing-2xl) 0; border-top: 1px solid var(--border-color); text-align: center;">
        <div class="container">
            <p class="text-secondary">Built with precision and passion ‚Ä¢ Powered by open-source APIs</p>
            <p class="text-sm text-tertiary mt-md">¬© 2024 TimeSync World</p>
        </div>
    </footer>

    <script>
        // Global State
        let currentTime = new Date();
        let serverOffset = 0;
        let userLocation = { city: 'Unknown', country: 'Unknown', timezone: Intl.DateTimeFormat().resolvedOptions().timeZone };
        
        const worldCities = [
            { name: 'New York', timezone: 'America/New_York', country: 'USA' },
            { name: 'London', timezone: 'Europe/London', country: 'UK' },
            { name: 'Tokyo', timezone: 'Asia/Tokyo', country: 'Japan' },
            { name: 'Sydney', timezone: 'Australia/Sydney', country: 'Australia' },
            { name: 'Paris', timezone: 'Europe/Paris', country: 'France' },
            { name: 'Dubai', timezone: 'Asia/Dubai', country: 'UAE' },
            { name: 'Singapore', timezone: 'Asia/Singapore', country: 'Singapore' },
            { name: 'Hong Kong', timezone: 'Asia/Hong_Kong', country: 'China' },
            { name: 'Los Angeles', timezone: 'America/Los_Angeles', country: 'USA' },
            { name: 'Mumbai', timezone: 'Asia/Kolkata', country: 'India' },
        ];

        let selectedCities = [worldCities[0], worldCities[1], worldCities[2], worldCities[3]];

        // Timer States
        let pomodoroTime = 25 * 60;
        let pomodoroRunning = false;
        let pomodoroInterval = null;
        let pomodoroCount = 0;

        let stopwatchTime = 0;
        let stopwatchRunning = false;
        let stopwatchInterval = null;

        let countdownTime = 10 * 60;
        let countdownTarget = 10 * 60;
        let countdownRunning = false;
        let countdownInterval = null;

        // Initialize
        async function init() {
            await detectLocation();
            await syncTime();
            startClock();
            renderWorldClock();
            renderDayNightMap();
            addTimezoneSlot();
            loadHistoricalEvents();
            
            // Update map every second
            setInterval(renderDayNightMap, 1000);
            
            // Load theme
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon();
        }

        // Detect Location
        async function detectLocation() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                userLocation = {
                    city: data.city || 'Unknown',
                    country: data.country_name || 'Unknown',
                    timezone: data.timezone || Intl.DateTimeFormat().resolvedOptions().timeZone
                };
                document.getElementById('locationInfo').textContent = `${userLocation.city}, ${userLocation.country}`;
            } catch (error) {
                console.error('Location detection failed:', error);
            }
        }

        // Time Sync
        async function syncTime() {
            try {
                const t0 = Date.now();
                const response = await fetch('https://timeapi.io/api/time/current/zone?timeZone=UTC');
                const t1 = Date.now();
                const data = await response.json();
                const serverTime = new Date(data.dateTime).getTime();
                const roundTripTime = t1 - t0;
                serverOffset = serverTime - (t0 + roundTripTime / 2);
                document.getElementById('accuracy').textContent = `¬±${roundTripTime}ms`;
            } catch (error) {
                console.error('Time sync failed:', error);
            }
        }

        function resyncTime() {
            syncTime();
        }

        // Clock Update
        function startClock() {
            setInterval(() => {
                currentTime = new Date(Date.now() + serverOffset);
                updateClockDisplay();
            }, 1);
        }

        function updateClockDisplay() {
            document.getElementById('hours').textContent = String(currentTime.getHours()).padStart(2, '0');
            document.getElementById('minutes').textContent = String(currentTime.getMinutes()).padStart(2, '0');
            document.getElementById('seconds').textContent = String(currentTime.getSeconds()).padStart(2, '0');
            document.getElementById('milliseconds').textContent = String(currentTime.getMilliseconds()).padStart(3, '0');
            
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('dateDisplay').textContent = currentTime.toLocaleDateString('en-US', dateOptions);
        }

        // World Clock
        function renderWorldClock() {
            const grid = document.getElementById('worldClockGrid');
            grid.innerHTML = '';
            
            selectedCities.forEach(city => {
                const localTime = new Date(currentTime.toLocaleString('en-US', { timeZone: city.timezone }));
                const hour = localTime.getHours();
                const isDaytime = hour >= 6 && hour < 18;
                
                const card = document.createElement('div');
                card.className = `card-glass clock-card ${isDaytime ? 'daytime' : 'nighttime'}`;
                card.innerHTML = `
                    <h3 class="font-bold text-xl mb-md">${city.name}</h3>
                    <p class="text-sm text-secondary mb-md">${city.country}</p>
                    <div class="text-4xl font-bold mb-md">
                        ${String(localTime.getHours()).padStart(2, '0')}:${String(localTime.getMinutes()).padStart(2, '0')}:${String(localTime.getSeconds()).padStart(2, '0')}
                    </div>
                    <div class="text-sm">${isDaytime ? '‚òÄÔ∏è Day' : 'üåô Night'}</div>
                `;
                grid.appendChild(card);
            });
        }

        setInterval(renderWorldClock, 1000);

        function filterCities() {
            const query = document.getElementById('citySearch').value.toLowerCase();
            // Simple filter - in real app would show dropdown
            console.log('Searching for:', query);
        }

        // Day/Night Map
        function renderDayNightMap() {
            const canvas = document.getElementById('dayNightMap');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, width, height);

            const now = currentTime;
            const dayOfYear = Math.floor((now - new Date(now.getFullYear(), 0, 0)) / 86400000);
            const solarDeclination = -23.44 * Math.cos((360 / 365) * (dayOfYear + 10) * Math.PI / 180);
            const hours = now.getUTCHours() + now.getUTCMinutes() / 60;
            const solarLongitude = -180 + (hours / 24) * 360;

            // Draw day gradient
            const dayGradient = ctx.createRadialGradient(width / 2, height / 2, 0, width / 2, height / 2, width / 2);
            dayGradient.addColorStop(0, 'rgba(255, 200, 100, 0.4)');
            dayGradient.addColorStop(1, 'rgba(100, 150, 255, 0.2)');
            ctx.fillStyle = dayGradient;
            ctx.fillRect(0, 0, width, height);

            // Draw sun position
            const sunX = ((solarLongitude + 180) / 360) * width;
            const sunY = ((90 - solarDeclination) / 180) * height;
            
            ctx.beginPath();
            ctx.arc(sunX, sunY, 12, 0, 2 * Math.PI);
            ctx.fillStyle = '#FFA500';
            ctx.fill();
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 3;
            ctx.stroke();

            // Draw grid
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.lineWidth = 1;
            for (let lat = -90; lat <= 90; lat += 30) {
                const y = ((90 - lat) / 180) * height;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            for (let lon = -180; lon <= 180; lon += 30) {
                const x = ((lon + 180) / 360) * width;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
        }

        // Timezone Converter
        function addTimezoneSlot() {
            const container = document.getElementById('timezoneSlots');
            const slot = document.createElement('div');
            slot.className = 'card-glass flex items-center gap-md';
            slot.innerHTML = `
                <select class="flex-1" onchange="updateTimezones()">
                    <option value="America/New_York">New York (EST/EDT)</option>
                    <option value="Europe/London">London (GMT/BST)</option>
                    <option value="Asia/Tokyo">Tokyo (JST)</option>
                    <option value="Australia/Sydney">Sydney (AEDT/AEST)</option>
                </select>
                <input type="time" class="flex-1" onchange="updateTimezones()">
                <button class="btn btn-secondary" onclick="this.parentElement.remove()">√ó</button>
            `;
            container.appendChild(slot);
        }

        function updateTimezones() {
            // Simplified - in real app would sync all times
            console.log('Updating timezones');
        }

        // Historical Events
        async function loadHistoricalEvents() {
            const container = document.getElementById('historicalEvents');
            const today = currentTime;
            const month = today.getMonth() + 1;
            const day = today.getDate();
            
            // Using a simple historical events API
            try {
                const response = await fetch(`https://history.muffinlabs.com/date/${month}/${day}`);
                const data = await response.json();
                
                let html = '<div class="flex flex-col gap-md">';
                data.data.Events.slice(0, 5).forEach(event => {
                    html += `
                        <div class="card" style="background: rgba(255,255,255,0.1);">
                            <div class="font-bold">${event.year}</div>
                            <div class="text-sm">${event.text}</div>
                        </div>
                    `;
                });
                html += '</div>';
                container.innerHTML = html;
            } catch (error) {
                container.innerHTML = '<p>Historical events unavailable</p>';
            }
        }

        // Pomodoro Timer
        function togglePomodoro() {
            pomodoroRunning = !pomodoroRunning;
            if (pomodoroRunning) {
                pomodoroInterval = setInterval(() => {
                    pomodoroTime--;
                    if (pomodoroTime <= 0) {
                        pomodoroCount++;
                        document.getElementById('pomodoroCount').textContent = pomodoroCount;
                        pomodoroTime = 25 * 60;
                        pomodoroRunning = false;
                        clearInterval(pomodoroInterval);
                        alert('Pomodoro complete! Take a break.');
                    }
                    updatePomodoroDisplay();
                }, 1000);
            } else {
                clearInterval(pomodoroInterval);
            }
        }

        function resetPomodoro() {
            pomodoroTime = 25 * 60;
            pomodoroRunning = false;
            clearInterval(pomodoroInterval);
            updatePomodoroDisplay();
        }

        function updatePomodoroDisplay() {
            const mins = Math.floor(pomodoroTime / 60);
            const secs = pomodoroTime % 60;
            document.getElementById('pomodoroDisplay').textContent = 
                `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // Stopwatch
        function toggleStopwatch() {
            stopwatchRunning = !stopwatchRunning;
            if (stopwatchRunning) {
                stopwatchInterval = setInterval(() => {
                    stopwatchTime++;
                    updateStopwatchDisplay();
                }, 1000);
            } else {
                clearInterval(stopwatchInterval);
            }
        }

        function resetStopwatch() {
            stopwatchTime = 0;
            stopwatchRunning = false;
            clearInterval(stopwatchInterval);
            updateStopwatchDisplay();
        }

        function updateStopwatchDisplay() {
            const hours = Math.floor(stopwatchTime / 3600);
            const mins = Math.floor((stopwatchTime % 3600) / 60);
            const secs = stopwatchTime % 60;
            document.getElementById('stopwatchDisplay').textContent = 
                `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // Countdown
        function setCountdown(minutes) {
            countdownTime = minutes * 60;
            countdownTarget = minutes * 60;
            updateCountdownDisplay();
        }

        function toggleCountdown() {
            countdownRunning = !countdownRunning;
            if (countdownRunning) {
                countdownInterval = setInterval(() => {
                    countdownTime--;
                    if (countdownTime <= 0) {
                        countdownRunning = false;
                        clearInterval(countdownInterval);
                        alert('Countdown complete!');
                    }
                    updateCountdownDisplay();
                }, 1000);
            } else {
                clearInterval(countdownInterval);
            }
        }

        function resetCountdown() {
            countdownTime = countdownTarget;
            countdownRunning = false;
            clearInterval(countdownInterval);
            updateCountdownDisplay();
        }

        function updateCountdownDisplay() {
            const mins = Math.floor(countdownTime / 60);
            const secs = countdownTime % 60;
            document.getElementById('countdownDisplay').textContent = 
                `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // Timer Switching
        function switchTimer(type) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('pomodoroTimer').classList.add('hidden');
            document.getElementById('stopwatchTimer').classList.add('hidden');
            document.getElementById('countdownTimer').classList.add('hidden');
            
            document.getElementById(type + 'Timer').classList.remove('hidden');
        }

        // Voice Commands
        function startVoiceCommand() {
            if (!('webkitSpeechRecognition' in window)) {
                alert('Voice recognition not supported in this browser. Try Chrome!');
                return;
            }

            const recognition = new webkitSpeechRecognition();
            recognition.lang = 'en-US';
            recognition.continuous = false;

            const btn = document.getElementById('voiceBtn');
            btn.classList.add('listening');

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.toLowerCase();
                console.log('Voice command:', transcript);
                
                // Simple command parsing
                if (transcript.includes('time in')) {
                    const city = transcript.split('time in')[1].trim();
                    speak(`The current time in ${city} is being displayed`);
                } else if (transcript.includes('start timer')) {
                    speak('Starting timer');
                } else {
                    speak('Command not recognized');
                }
            };

            recognition.onend = () => {
                btn.classList.remove('listening');
            };

            recognition.start();
        }

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            window.speechSynthesis.speak(utterance);
        }

        // Theme Toggle
        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const newTheme = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const theme = document.documentElement.getAttribute('data-theme');
            document.getElementById('themeToggle').textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        // Start the app
        init();
    </script>
</body>
</html>
